<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secured V2 - Profile</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="menu.css"> <!-- Added Menu CSS -->
    <script src="particles.js"></script> <!-- Added Particles.js -->
    <script src="app.js"></script> <!-- Added App.js -->
    <script src="settings.js"></script> <!-- Added Settings.js -->
    <script src="analytics.js"></script> <!-- Added Analytics.js -->
    <script src="https://cdn.jsdelivr.net/npm/@widgetbot/crate@3" async defer>
        new Crate({
            server: '1045821677583474808',
            channel: '1046287752032956537',
        });
    </script> <!-- Added Crate Widget for Discord -->
</head>
<body>
    <!-- Top Floating Menu -->
    <header class="top-menu">
        <div class="logo">
            <a href="https://gghunter12.github.io/secured-web/">SECURED WEB</a>
        </div>
        <nav>
            <ul>
                <li><a href="https://gghunter12.github.io/secured-web/" class="menu-button">üè† Home</a></li>
                <li><a href="https://gghunter12.github.io/secured-web/games" class="menu-button">üéÆ Games</a></li>
                <li><a href="https://gghunter12.github.io/secured-web/partners" class="menu-button">ü§ù Partners</a></li>
                <li><a href="https://gghunter12.github.io/secured-web/settings" class="menu-button">‚öôÔ∏è Settings</a></li>
                <!-- User Profile Picture as Button -->
                <li>
                    <a href="https://gghunter12.github.io/secured-web/profile.html" class="profile-button">
                        <img id="menu-profile-pic" src="https://www.mobile-calendar.com/img/main/user.webp" alt="Profile">
                    </a>
                </li>
            </ul>
        </nav>
    </header>

    <div class="center-box">
        <h1>Login</h1>
        <p>Sign in to access your account.</p>

        <button id="sign-in-btn" onclick="signIn()">Sign in with Google</button>

        <div id="profile-url" style="display:none;">
            <p>Your Profile URL: <a id="profile-url-text" href="#">Loading...</a></p>
        </div>
    </div>

    <script type="module">
        // Firebase setup
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBV7JbLkjDnc0pkbawwjdAg5bLRBOgnV4E",
            authDomain: "d-web-9b2ea.firebaseapp.com",
            projectId: "d-web-9b2ea",
            storageBucket: "d-web-9b2ea.firebasestorage.app",
            messagingSenderId: "709249421953",
            appId: "1:709249421953:web:ccc763acf13d28716f3380",
            measurementId: "G-D7PBM8E1PV"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();
        const db = getFirestore(app);

        // Sign-in function
        function signIn() {
            signInWithPopup(auth, provider)
                .then((result) => {
                    const user = result.user;
                    saveUserData(user);
                    generateProfileUrl(user.uid);
                })
                .catch((error) => {
                    console.error("Sign-in error", error);
                });
        }

        // Save user data to Firestore
        function saveUserData(user) {
            const userRef = doc(db, "users", user.uid);
            setDoc(userRef, {
                displayName: user.displayName,
                photoURL: user.photoURL,
                email: user.email
            });
        }

        // Generate profile URL with UID
        function generateProfileUrl(uid) {
            const profileUrl = `https://gghunter12.github.io/secured-web/account?uid=${uid}`;
            document.getElementById("profile-url-text").innerText = profileUrl;
            document.getElementById("profile-url-text").href = profileUrl;
            document.getElementById("profile-url").style.display = "block";
        }
    </script>
</body>
</html>
